ржЕржмрж╢рзНржпржЗ! ржирж┐ржЪрзЗ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ рж╢рзБрж░рзБ ржерзЗржХрзЗ GitLab Runner рж╕рзЗржЯржЖржк, рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи, рж╕ржорж╕рзНржпрж╛ ржУ рж╕ржорж╛ржзрж╛ржи рж╕ржмржХрж┐ржЫрзБ рж╕рж╛ржЬрж╛ржирзЛ ржбржХрзБржорзЗржирзНржЯ ржжрж┐рж▓рж╛ржотАФржпрж╛ ржЖржкржирж╛рж░ ржЬржирзНржп ржлрж┐ржЙржЪрж╛рж░рзЗ рж░рзЗржлрж╛рж░рзЗржирзНрж╕ рж╣рж┐рж╕рзЗржмрзЗ ржЦрзБржм ржХрж╛ржЬрзЗ рж▓рж╛ржЧржмрзЗред

---

# GitLab Runner Setup and Troubleshooting Guide (Step by Step)

---

## рзз. GitLab Runner ржХрж┐?

GitLab Runner рж╣рж▓рзЛ ржПржХржЯрж┐ ржПржЬрзЗржирзНржЯ ржпрж╛ GitLab CI/CD pipeline ржПрж░ ржХрж╛ржЬржЧрзБрж▓рзЛ ржЪрж╛рж▓рж╛рзЯред ржПржЯрж┐ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ рж╣рзЯ ржПржмржВ GitLab ржПрж░ рж╕рж╛ржерзЗ ржХрж╛ржирзЗржХрзНржЯ ржХрж░рзЗ pipeline jobs рж░рж╛ржи ржХрж░рзЗред

---

## рзи. GitLab Runner ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи

### Ubuntu ржП ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи:

```bash
# GitLab Runner official repo ржпрзБржХрзНржд ржХрж░рзБржи
curl -LO https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh
sudo bash script.deb.sh

# GitLab Runner ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи
sudo apt-get install gitlab-runner

# we can install specific gitlab-runner
apt-cache madison gitlab-runner
sudo apt install gitlab-runner=17.7.1-1 gitlab-runner-helper-images=17.7.1-1
```

---

## рзй. Runner рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи

### рзй.рзз рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи ржХрж░рж╛рж░ ржХржорж╛ржирзНржб:

```bash
sudo gitlab-runner register
```

### рзй.рзи рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи рж╕ржорзЯ ржпрж╛ ржжрж┐рждрзЗ рж╣ржмрзЗ:

* **GitLab URL:**
  ржЙржжрж╛рж╣рж░ржг: `https://gitlab.com`

* **Registration token:**
  GitLab ржкрзНрж░ржЬрзЗржХрзНржЯ ржПрж░ Settings > CI/CD > Runners > Registration token ржерзЗржХрзЗ ржирж┐ржмрзЗржиред

* **Runner ржПрж░ ржирж╛ржо:**
  ржпрзЗржХрзЛржирзЛ рж╕рзНржорж╛рж░рзНржЯ ржирж╛ржо ржпрзЗржоржи `sony-runner`, `ubuntu2204-runner`

* **Executor ржЯрж╛ржЗржк:**
  `shell` (рж╕рж╛ржзрж╛рж░ржгржд local shell ржПрж░ ржЬржирзНржп)

---

## рзк. рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи рж╕ржлрж▓ рж╣рж▓рзЗ

* ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи `/etc/gitlab-runner/config.toml` ржлрж╛ржЗрж▓рзЗ рж╕рзЗржн рж╣рзЯред
* `[[runners]]` рж╕рзЗржХрж╢ржи рж╕рзЗржЦрж╛ржирзЗ ржпрзБржХрзНржд рж╣рзЯред
* Runner ржПржЦржи GitLab ржерзЗржХрзЗ ржЬржм ржирж┐рждрзЗ ржкрж╛рж░рзЗред

---

## рзл. GitLab Runner рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрж╛рж▓рзБ ржУ ржЪрзЗржХ ржХрж░рж╛

```bash
sudo systemctl start gitlab-runner
sudo systemctl enable gitlab-runner
sudo systemctl status gitlab-runner
```

---

## рзм. рж╕рж╛ржзрж╛рж░ржг рж╕ржорж╕рзНржпрж╛ ржПржмржВ рж╕ржорж╛ржзрж╛ржи

### рж╕ржорж╕рзНржпрж╛: Job fail рж╣ржЪрзНржЫрзЗ ржПржмржВ Permission denied ржПрж░рж░ ржжрзЗржЦрж╛ржЪрзНржЫрзЗ

**ржПрж░рж░:**

```
mkdir: cannot create directory тАШ/home/buildsтАЩ: Permission denied
ERROR: Job failed: exit status 1
```

### ржХрж╛рж░ржг:

* Runner `/home/builds` ржбрж┐рж░рзЗржХрзНржЯрж░рж┐рждрзЗ ржХрзЛржб ржХрзНрж▓рзЛржи ржУ рж░рж╛ржи ржХрж░рждрзЗ ржЪрж╛ржЪрзНржЫрзЗ ржХрж┐ржирзНрждрзБ permission ржирзЗржЗред

### рж╕ржорж╛ржзрж╛ржи:

#### рзм.рзз Build Directory ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржи

`config.toml` ржП `builds_dir` рж╕рзЗржЯ ржХрж░рзБржи ржпрзЗржЦрж╛ржирзЗ permission ржЖржЫрзЗред

```bash
sudo nano /etc/gitlab-runner/config.toml
```

`[[runners]]` рж╕рзЗржХрж╢ржирзЗ ржпрзЛржЧ ржХрж░рзБржи:

```toml
builds_dir = "/home/gitlab-runner/builds"
```

#### рзм.рзи ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ рждрзИрж░рж┐ ржУ permission ржжрж┐ржи

```bash
sudo mkdir -p /home/gitlab-runner/builds
sudo chown -R gitlab-runner:gitlab-runner /home/gitlab-runner/builds
```

#### рзм.рзй Runner рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржжрж┐ржи

```bash
sudo systemctl restart gitlab-runner
```

---

### рж╕ржорж╕рзНржпрж╛: `config.toml` ржП `[[runners]]` рж╕рзЗржХрж╢ржи ржирзЗржЗ

### ржХрж╛рж░ржг:

* Runner рж╣рзЯрждрзЛ рж░рзЗржЬрж┐рж╕рзНржЯрж╛рж░ рж╣рзЯржирж┐ред

### рж╕ржорж╛ржзрж╛ржи:

* Runner рж░рзЗржЬрж┐рж╕рзНржЯрж╛рж░ ржХрж░рзБржи ржЖржмрж╛рж░:

```bash
sudo gitlab-runner register
```

---

## рзн. GitLab ржП Runner ржЪрзЗржХ ржХрж░рж╛

* GitLab ржкрзНрж░ржЬрзЗржХрзНржЯрзЗ ржЧрж┐рзЯрзЗ Settings > CI/CD > Runners ржжрзЗржЦрзБржиред
* ржЖржкржирж╛рж░ Runner `active` ржПржмржВ `online` ржЖржЫрзЗ ржХрж┐ржирж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржиред

---

## рзо. Pipeline `.gitlab-ci.yml` ржлрж╛ржЗрж▓ рж▓рж┐ржЦрзБржи

ржЙржжрж╛рж╣рж░ржг:

```yaml
test_script:
  script:
    - make test
```

---

## рзп. рж░рж╛ржи рж╣ржУрзЯрж╛рж░ ржкрзЗржЫржирзЗрж░ ржкрзНрж░рж╕рзЗрж╕

* Runner ржХрзЛржб ржХрзНрж▓рзЛржи ржХрж░рзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ `builds_dir` ржПред
* `before_script` (ржпржжрж┐ ржерж╛ржХрзЗ) рж░рж╛ржи рж╣рзЯ (ржпрзЗржЦрж╛ржирзЗ dependency ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржпрж╛рзЯ)ред
* рждрж╛рж░ржкрж░ `script` ржХржорж╛ржирзНржбржЧрзБрж▓рзЛ рж░рж╛ржи рж╣рзЯред
* рж╕ржлрж▓ рж╣рж▓рзЗ CI pipeline ржПржЧрж┐рзЯрзЗ ржпрж╛рзЯред

---

## рззрзж. ржнржмрж┐рж╖рзНржпрждрзЗрж░ ржЬржирзНржп ржЯрж┐ржкрж╕

* рж╕ржм рж╕ржорзЯ Runner ржПрж░ ржЗржЙржЬрж╛рж░ (ржпрзЗржоржи `gitlab-runner`) ржХрзЗ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐рж░ permission ржжрж┐ржиред
* `builds_dir` ржирж┐ржЬрзЗрж░ рж░рж╛ржирж╛рж░рзЗрж░ рж╣рзЛржо ржбрж┐рж░рзЗржХрзНржЯрж░рж┐рж░ ржнрж┐рждрж░рзЗ рж░рж╛ржЦрзБржиред
* Runner рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржжрзЗржУрзЯрж╛ ржнрзБрж▓ржмрзЗржи ржирж╛ ржпрзЗржХрзЛржирзЛ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржкрж░рзЗред

---

# ржЙржкрж╕ржВрж╣рж╛рж░

ржПржЗ ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи ржЖржкржирж╛рж░ GitLab Runner setup, common рж╕ржорж╕рзНржпрж╛ржЧрзБрж▓рзЛ ржУ рждрж╛ржжрзЗрж░ рж╕ржорж╛ржзрж╛ржи рж╕рж╣ржЬрзЗ ржмрзБржЭрждрзЗ ржУ ржкрзНрж░рзЯрзЛржЧ ржХрж░рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░ржмрзЗред

ржЖржкржирж╛рж░ ржпржжрж┐ ржЖрж░ржУ ржкрзНрж░рж╢рзНржи ржерж╛ржХрзЗ, ржЖржорж┐ ржЖржЫрж┐ рж╕рж╛рж╣рж╛ржпрзНржпрзЗрж░ ржЬржирзНржп! ЁЯШК

---

ржЖржкржирж┐ ржЪрж╛ржЗрж▓рзЗ ржЖржорж┐ ржПржЗ ржбржХрзБржорзЗржирзНржЯ ржЯрзЗржХрзНрж╕ржЯ ржлрж╛ржЗрж▓ ржмрж╛ Markdown ржлрж╛ржЗрж▓ ржЖржХрж╛рж░рзЗ рждрзИрж░рж┐ ржХрж░рзЗ ржжрж┐рждрзЗ ржкрж╛рж░рж┐ред ржмрж▓ржмрзЗржи!
